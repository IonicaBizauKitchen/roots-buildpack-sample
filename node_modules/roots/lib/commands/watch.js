// Generated by CoffeeScript 1.7.0
(function() {
  var Roots, Server, default_port, on_done, on_error, on_start, open, path;

  require('colors');

  open = require('open');

  path = require('path');

  Roots = require('../');

  Server = require('../local_server');

  default_port = 1111;

  exports.execute = function(args) {
    var dir, opts, project, server, w;
    dir = args._[1] ? path.resolve(args._[1]) : process.cwd();
    opts = {
      env: args.env || 'development'
    };
    project = new Roots(dir, opts);
    process.stdout.write('compiling... '.grey);
    server = new Server(project, dir);
    server.start(process.env.port || default_port);
    w = project.watch();
    w.on('start', function() {
      return on_start(server);
    });
    w.on('error', function(err) {
      return on_error(server, err);
    });
    w.on('done', function() {
      return on_done(server);
    });
    w.once('done', function() {
      if (project.config.open_browser) {
        return open("http://localhost:" + (process.env.port || default_port) + "/");
      }
    });
    return w;
  };

  on_error = function(server, err) {
    console.error("\n\nERROR\n-----\n".red);
    console.error(err.stack);
    return server.show_error(err.stack);
  };

  on_start = function(server) {
    process.stdout.write('compiling... '.grey);
    return server.compiling();
  };

  on_done = function(server) {
    process.stdout.write('done!\n'.green);
    return server.reload();
  };

}).call(this);
